Fix a bug that could cause filtering to fail on very short datasets.
