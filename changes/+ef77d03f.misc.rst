Remove significant amounts of dead code, reorganize for clarity
